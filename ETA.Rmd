---
title: "ets"
author: "Sitha Jawahar"
date: "17/10/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)

library(readr)
library(tidyverse)
library(ggplot2)
library(lubridate)
library(kableExtra)
library(DT)
library(dygraphs)
library(xts)
library(plotly)
library(quantmod)

```

```{r}
lga <- read_csv("data/lga.csv")

```

```{r}
lga_clean <- lga %>%
  mutate(Localgovernmentarea = sapply(strsplit(lga_clean$Localgovernmentarea,
                                               split=' ',
                                               fixed=TRUE),
                                      function(x) (x[1]))) %>% 
  select(diagnosis_date, Localgovernmentarea, acquired) %>% 
  mutate(count = 1) %>% 
  group_by(diagnosis_date, Localgovernmentarea, acquired) %>% 
  tally() %>% 
  pivot_wider(names_from = "Localgovernmentarea",
              values_from = n) 

lga_clean[is.na(lga_clean)] <- 0

lga_clean <- lga_clean %>% 
  pivot_longer(cols = c(3:79),
               names_to = "Localgovernmentarea",
               values_to = "count")

```



```{r}

lga_2020 <- lga_clean %>% 
  mutate(month = month(diagnosis_date, label = TRUE)) %>% 
  mutate(year = year(diagnosis_date)) %>% 
  mutate(diagnosis_date = as.Date(diagnosis_date))%>% 
  group_by(acquired) %>% 
  filter(year == "2020") %>% 
  filter(month == c("May",
                    "Jun",
                     "Jul",
                    "Aug",
                    "Sep")) 
```



Wyndham, Brimbank, HUme, Melton, Whittlesea, Melbourne


```{r}

lgagraph <- lga_2020 %>%
  select(diagnosis_date, Localgovernmentarea, acquired, count, month) %>%
  group_by(diagnosis_date,month, Localgovernmentarea, acquired) %>%
  summarise(count = sum(count)) %>%
  arrange(desc(count)) %>%
  filter(Localgovernmentarea %in% c("Wyndham",
                                    "Brimbank",
                                    "Hume",
                                    "Melton",
                                    "Whittlesea")) 



p <- ggplot(lgagraph, aes(diagnosis_date, count, color = Localgovernmentarea, group = 1))+
     geom_line() +
  ggtitle("Contact with a confirmed cases")+
  xlab("date")+
  ylab("No.of cases")
ggplotly(p) %>% 
layout(
  xaxis = list (rangeslider =
                  list(type = "date"))
)  
  
  



```



```{r}


lgagraph_travel <- lga_2020 %>%
  select(diagnosis_date, Localgovernmentarea, acquired, count) %>%
  group_by(diagnosis_date, Localgovernmentarea, acquired) %>%
   filter(acquired == "Travel overseas") %>% 
  filter(Localgovernmentarea %in% c(
                                    "Casey",
                                    "Hume",
                                    "Melton",
                                    "Moonee",
                                    "Interstate")) %>%
  arrange(desc(count))

  # pivot_wider(id_cols = NULL, names_from = Localgovernmentarea, values_from = count)  
  
# 
# lgagraph_travel$date<-as.POSIXct(paste(lgagraph_travel$diagnosis_date, lgagraph_travel$diagnosis_date), format="%Y-%m-%d %H")
# lgagraph_travel[is.na(lgagraph_travel)] <- 0
# lgagraph_travel %>%
#   select(date, Interstate, Moonee, Hume, Melton, Casey)%>%
#   xts(order.by=as.POSIXct(lgagraph_travel$date))%>%
#   dygraph( main = "Travel Overseas",
#          xlab = "Date") %>%
#   dyOptions(drawGrid = T, digitsAfterDecimal=5)%>%
#    dyRangeSelector()%>%
#    dyLegend(show = "follow")

p1 <- ggplot(lgagraph_travel, aes(diagnosis_date, count, color = Localgovernmentarea, group = 1))+
     geom_line() +
  ggtitle("Travel Overseas")+
  xlab("date")+
  ylab("No.of cases")
ggplotly(p1) %>% 
layout(
  xaxis = list (rangeslider =
                  list(type = "date"))
)  



```




Interstate, Casey, Melton


```{r}
lga45 <- lga_2020 %>%
  select(diagnosis_date, Localgovernmentarea, acquired, count) %>%
  group_by(diagnosis_date, Localgovernmentarea, acquired) %>%
   filter(acquired == "Acquired in Australia, unknown source") %>% 
  filter(Localgovernmentarea %in% c(
                                    "Melbourne",
                                    "Brimbank",
                                    "Wyndham",
                                    "Hume",
                                    "Melton")) %>%
  arrange(desc(count)) 


p2 <- ggplot(lga45, aes(diagnosis_date, count, color = Localgovernmentarea, group = 1))+
     geom_line() +
  ggtitle("Unknown source in OZ")+
  xlab("date")+
  ylab("No.of cases")
ggplotly(p2) %>% 
layout(
  xaxis = list (rangeslider =
                  list(type = "date"))
)   

```




Melbourne, Brimbank, Wyndham, Melton, Hume, Whittlesea. 

So Melbourne is not very high on travel cases because it was completely closed to international students, tourists and any outsiders, making the only way for the infection spreading through locals. Which is why it is there in plots 1 and 3. 


