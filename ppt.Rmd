---
title: "Presentation 5523"
subtitle: ""
author: "Shaine, Smriti, Sitha"
date: " `r Sys.Date()` "
output:
  xaringan::moon_reader:
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---

```{r, setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE)
```

```{r}
library(tidyverse)
library(lubridate)
library(sf)
library(ggplot2)
library(cartogram)
library(leaflet)
library(readxl)
library(plotly)
library(viridis)
library(xaringanExtra)
```

```{r xaringan-panelset, echo=FALSE}
xaringanExtra::use_panelset()
```

```{r data}
vic_cases <- read_csv("data/NCOV_COVID_Cases_by_LGA_20211016.csv")
vic_cases_source <- read_csv("data/NCOV_COVID_Cases_by_LGA_Source_20211015.csv")

# Filter for dates

vic_cases <- vic_cases %>%
  filter(diagnosis_date >= "2020-05-01" & diagnosis_date <= "2020-09-30")

vic_cases_source <- vic_cases_source %>%
  filter(diagnosis_date >= "2020-05-01" & diagnosis_date <= "2020-09-30")


vic_cases_aggregate <- vic_cases %>%
  mutate(Localgovernmentarea = sapply(strsplit(vic_cases$Localgovernmentarea,
                                               split=' ',
                                               fixed=TRUE),
                                      function(x) (x[1]))) %>%
  group_by(Localgovernmentarea) %>%
  tally() %>%
  mutate(NAME = toupper(Localgovernmentarea))




  
```

```{r map, results='hide'}

vic_map <- st_read(dsn = "data/Order_T8YRCY/ll_gda2020/esrishape/whole_of_dataset/victoria/VMADMIN/AD_LGA_AREA_POLYGON.shp")


vic_map_postcode <- st_read(dsn = "data/Order_T8YRCY/ll_gda2020/esrishape/whole_of_dataset/victoria/VMADMIN/POSTCODE_POLYGON.shp")

```

.panelset[
.panel[.panel-name[Leaflet]
```{r}

vic_map_postcode <- vic_map_postcode %>% 
  mutate(Postcode = as.numeric(POSTCODE))

cases <- vic_cases_source %>% 
  group_by(Postcode) %>% 
  tally() 

vic_map_postcode <- left_join(vic_map_postcode, cases)

# This is the leaflet plot
pal_fun <- colorQuantile("viridis", vic_map_postcode$n, n = 6, na.color = "white", reverse = TRUE)

p_popup <- paste0("<strong>LGA</strong> : ", vic_map$OFFICIALNM)
                  

leaflet <- leaflet(vic_map_postcode) %>%
  addPolygons(
    color = 'grey',
    weight = 2,
    fillColor = ~pal_fun(n),
    fillOpacity= 0.7,
    smoothFactor = 0.5,
    stroke = FALSE,
    group = "postcode") %>%
  addPolygons(
    data=vic_map,
    weight = 1,
    fillOpacity = 0,
    color = "grey",
    group = "LGA",
    popup = p_popup) %>%
  addTiles()

f <- paste0("leaflet.html")
htmlwidgets::saveWidget(leaflet, f)
htmltools::tags$iframe(
    src=f,
    width="100%", 
    height="100%",
    scrolling="no", 
    seamless="seamless", 
    frameBorder="0"
  )
```
]

.panel[.panel-name[check]
Let's just try
]


---

.panelset[
.panel[.panel-name[Cartogram Map]
```{r echo=FALSE, out.height=600, out.width= 600}
knitr::include_graphics("carto.png")
```
]

.panel[.panel-name[Bar Plot]
```{r}

pop <- read_excel(path = "data/32180ds0002_2017-18.xls",
                  sheet = "Table 2",
                  skip = 7)

pop <- pop %>%
  select(`Local Government Area`, no....4) %>%
  na.omit()

pop <- pop %>%
  mutate(NAME = sapply(strsplit(pop$`Local Government Area`,
                                split=' ',
                                fixed=TRUE),
                       function(x) (x[1])),
         pop = no....4) %>%
  select(NAME, pop) %>%
  mutate(NAME = toupper(NAME))

pop_cases <- pop %>%
  left_join(vic_cases_aggregate) %>%
  na.omit() %>%
  arrange(desc(pop)) %>%
  head(20)
  

ggplot(data = pop_cases, aes(y = reorder(NAME, pop))) +
  geom_bar(aes(x = n), stat="identity", position="identity", alpha=.8, fill='pink',
           color='red') +
  theme_minimal()

```
]
]









